{"version":3,"sources":["bootstrap.js"],"names":["reduce","Function","bind","call","Array","prototype","isEnumerable","Object","propertyIsEnumerable","concat","keys","values","O","v","k","entries","object","map","key","ready","callBack","RV","allScriptsLoaded","readyQueue","push","fireRvReady","forEach","cb","getMap","id","mapRegistry","loadScript","src","loadCallback","currScript","d","createElement","async","type","addEventListener","bodyNode","appendChild","versionCheck","ourVersion","theirVersion","scriptName","split","versionDiff","x","index","parseInt","find","fillText","console","warn","versions","jQuery","window","isIE","test","navigator","userAgent","isSafari","platform","assign","debug","_nodes","_deferredPolyfills","dataTables","customAttrs","URLs","document","scripts","getElementsByTagName","seedUrl","length","repo","substring","lastIndexOf","headNode","stylesLink","href","rel","media","fontsLink","scriptsArr","$","fn","dataTable","jquery","version","mapProxy","_appPromise","_initAppPromise","appID","_proxy","action","_len","arguments","args","_key","this","then","appInstance","apply","_initProxy","_len2","_key2","loadRcsLayers","setLanguage","lang","getBookmark","useBookmark","bookmark","initialBookmark","centerAndZoom","y","spatialRef","zoom","restoreSession","keysArray","getRcsLayerIDs","registerPlugin","_arguments","_loadPromise","app","_init","_this","Promise","resolve","_registerMap","_applicationLoaded","_registerPreLoadApi","_deregisterMap","nodes","slice","getElementsByClassName","isAttrNodes","querySelectorAll","filter","node","indexOf","counter","appId","getAttribute","attrName","setAttribute","className","info","create","dp","focusManager","init","trackFocusBuilder","detectBlur","event","activeElement","isSameActiveElement","currentActiveElement","lastActiveElement","detectFocus","attachEvents","detachEvents","removeEventListener","isActive","_trackFocus"],"mappings":"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","file":"../bootstrap.js","sourcesContent":["(function () {\r\n    'use strict';\r\n    var reduce = Function.bind.call(Function.call, Array.prototype.reduce);\r\n    var isEnumerable = Function.bind.call(Function.call, Object.prototype.propertyIsEnumerable);\r\n    var concat = Function.bind.call(Function.call, Array.prototype.concat);\r\n    var keys = Object.keys;\r\n    // apparently using Object.keys is not spec compliant, but it's in a very odd case\r\n    // and using Object.keys makes IE happy https://bugzilla.mozilla.org/show_bug.cgi?id=1208464#c13\r\n\r\n    if (!Object.values) {\r\n        Object.values = function values(O) {\r\n            return reduce(keys(O), function (v, k) {\r\n                return concat(v, typeof k === 'string' && isEnumerable(O, k) ? [O[k]] : []);\r\n            }, []);\r\n        };\r\n        /*\r\n    Object.values = (object) => Object.keys(object).map(\r\n            (key) => object[key]\r\n        );\r\n        */\r\n    }\r\n\r\n    if (!Object.entries) {\r\n        /*\r\n        Object.entries = function entries(O) {\r\n            return reduce(keys(O), function (e, k) {\r\n                return concat(e, typeof k === 'string' && isEnumerable(O, k) ? [[k, O[k]]] : []);\r\n            }, []);\r\n        };\r\n        */\r\n        Object.entries = function (object) {\r\n            return Object.keys(object)\r\n                .map(function (key) {\r\n                    return [key, object[key]];\r\n                });\r\n        };\r\n    }\r\n}());\r\n\n'use strict';\n\n(function () {\n    // jshint ignore:line\n    // disabled checks on above line due to 'too many statements in this function' (jshint W071)\n\n    /**\r\n     * Dynamically injects the main viewer script and styles references.\r\n     * TODO: need to check how viewer works if there is already a version of jQuery on the page; maybe load a jQuery-less version of the viewer then.\r\n     * Reference on script loading: http://www.html5rocks.com/en/tutorials/speed/script-loading/\r\n     */\n\n    // check if the global RV registry object already exists and store a reference\n    var RV = window.RV = typeof window.RV === 'undefined' ? {} : window.RV;\n\n    // test user browser, true if IE false otherwise\n    RV.isIE = /Edge\\/|Trident\\/|MSIE /.test(window.navigator.userAgent);\n\n    // Safari problem with file saver: https://github.com/eligrey/FileSaver.js/#supported-browsers\n    // test if it is Safari browser on desktop and it if is, show a message to let user know we can't automatically save the file\n    // they have to save it manually the same way as when the canvas is tainted.\n    RV.isSafari = /^((?!chrome|android|crios|fxios).)*safari/i.test(navigator.userAgent) && !/(iPhone|iPod|iPad)/i.test(navigator.platform);\n\n    // set these outside of the initial creation in case the page defines RV for setting\n    // properties like dojoURL\n    Object.assign(RV, {\n        getMap: getMap,\n        ready: ready,\n        allScriptsLoaded: false,\n        debug: {},\n        _nodes: null,\n        _deferredPolyfills: RV._deferredPolyfills || [] // holds callback for any polyfills or patching that needs to be done after the core.js is loaded\n    });\n\n    // versions of scripts to inject\n    var versions = {\n        jQuery: '2.2.1',\n        dataTables: '1.10.11'\n    };\n    var customAttrs = ['config', 'langs', 'service-endpoint', 'restore-bookmark', 'wait', 'keys', 'fullpage-app'];\n    var URLs = {\n        jQuery: 'http://ajax.aspnetcdn.com/ajax/jQuery/jquery-' + versions.jQuery + '.min.js',\n        dataTables: 'https://cdn.datatables.net/' + versions.dataTables + '/js/jquery.dataTables.min.js'\n    };\n    var d = document;\n    var scripts = d.getElementsByTagName('script'); // get scripts\n\n    // TODO: make more robust; this way of getting script's url might break if the `asyn` attribute is added on the script tag\n    var seedUrl = scripts[scripts.length - 1].src; // get the last loaded script, which is this\n    var repo = seedUrl.substring(0, seedUrl.lastIndexOf('/'));\n\n    var headNode = d.getElementsByTagName('head')[0];\n    var bodyNode = d.getElementsByTagName('body')[0];\n\n    // inject styles\n    var stylesLink = d.createElement('link');\n    stylesLink.href = './css/main.css';\n    stylesLink.type = 'text/css';\n    stylesLink.rel = 'stylesheet';\n    stylesLink.media = 'screen,print';\n\n    headNode.appendChild(stylesLink);\n\n    // inject fonts\n    var fontsLink = d.createElement('link');\n    fontsLink.href = 'https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic';\n    fontsLink.rel = 'stylesheet';\n\n    headNode.appendChild(fontsLink);\n\n    var scriptsArr = [];\n\n    // append proper srcs to scriptsArray\n    if (!window.jQuery) {\n        // TODO: should we use a local file here instead?\n        scriptsArr.push(URLs.jQuery, URLs.dataTables);\n    } else if (!$.fn.dataTable) {\n        scriptsArr.push(URLs.dataTables);\n        versionCheck(versions.jQuery, $.fn.jquery, 'jQuery');\n    } else {\n        versionCheck(versions.jQuery, $.fn.jquery, 'jQuery');\n        versionCheck(versions.dataTables, $.fn.dataTable.version, 'dataTable');\n    }\n\n    // registry of map proxies\n    var mapRegistry = [];\n\n    var readyQueue = []; // array of callbacks waiting on script loading to complete\n\n    // appeasing this rule makes the code fail disallowSpaceAfterObjectKeys\n    /* jscs:disable requireSpacesInAnonymousFunctionExpression */\n    var mapProxy = {\n        _appPromise: null,\n        _initAppPromise: null,\n        appID: null,\n\n        _proxy: function _proxy(action) {\n            for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n                args[_key - 1] = arguments[_key];\n            }\n\n            return this._appPromise.then(function (appInstance) {\n                return appInstance[action].apply(appInstance, args);\n            });\n        },\n\n        _initProxy: function _initProxy(action) {\n            for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n                args[_key2 - 1] = arguments[_key2];\n            }\n\n            return this._initAppPromise.then(function (appInstance) {\n                return appInstance[action].apply(appInstance, args);\n            });\n        },\n\n        loadRcsLayers: function loadRcsLayers(keys) {\n            this._proxy('loadRcsLayers', keys);\n        },\n\n        setLanguage: function setLanguage(lang) {\n            this._proxy('setLanguage', lang);\n        },\n\n        getBookmark: function getBookmark() {\n            return this._proxy('getBookmark');\n        },\n\n        useBookmark: function useBookmark(bookmark) {\n            this._proxy('useBookmark', bookmark);\n        },\n\n        initialBookmark: function initialBookmark(bookmark) {\n            this._initProxy('initialBookmark', bookmark);\n        },\n\n        centerAndZoom: function centerAndZoom(x, y, spatialRef, zoom) {\n            this._proxy('centerAndZoom', x, y, spatialRef, zoom);\n        },\n\n        restoreSession: function restoreSession(keysArray) {\n            this._initProxy('restoreSession', keysArray);\n        },\n\n        getRcsLayerIDs: function getRcsLayerIDs() {\n            return this._proxy('getRcsLayerIDs');\n        },\n\n        /**\r\n         * Registers a plugin with a viewer instance.\r\n         * This function expects a minimum of two parameters such that:\r\n         *   - the first parameter is a plugin class reference\r\n         *   - the second parameter is a unique plugin id string\r\n         * Any additional parameters will be passed to the plugins init method\r\n         *\r\n         * @function    registerPlugin\r\n         */\n        registerPlugin: function registerPlugin() {\n            var _arguments = arguments;\n\n            this._loadPromise.then(function (app) {\n                return app.registerPlugin.apply(app, _arguments);\n            });\n        },\n\n        _init: function _init(appID) {\n            var _this = this;\n\n            this.appID = appID;\n\n            this._appPromise = new Promise(function (resolve) {\n                return(\n                    // store a callback function in the proxy object itself for map instances to call upon readiness\n                    _this._registerMap = function (appInstance) {\n                        return(\n                            // resolve with the actual instance of the map;\n                            // after this point, all queued calls to `loadRcsLayers`, `setLanguage`, etc. will trigger\n                            resolve(appInstance)\n                        );\n                    }\n                );\n            });\n\n            // this promise waits to be resolved by the rvReady event on the angular side\n            // unlike the other promises this is only resolved once during the page load cycle\n            if (typeof this._loadPromise === 'undefined') {\n                this._loadPromise = new Promise(function (resolve) {\n                    return(\n                        // store a callback function in the proxy object itself for map instances to call upon readiness\n                        _this._applicationLoaded = function (appInstance) {\n                            return resolve(appInstance);\n                        }\n                    );\n                });\n            }\n\n            this._initAppPromise = new Promise(function (resolve) {\n                return(\n                    // store a callback function in the proxy object itself for map instances to call upon readiness\n                    _this._registerPreLoadApi = function (appInstance) {\n                        return(\n                            // resolve with the actual instance of the map;\n                            // after this point, all queued calls to `loadRcsLayers`, `setLanguage`, etc. will trigger\n                            resolve(appInstance)\n                        );\n                    }\n                );\n            });\n\n            return this;\n        },\n\n        _deregisterMap: function _deregisterMap() {\n            this._init();\n        }\n    };\n    /* jshint:enable requireSpacesInAnonymousFunctionExpression */\n\n    // convert html collection to array:\n    // https://babeljs.io/docs/learn-es2015/#math-number-string-object-apis\n    var nodes = [].slice.call(document.getElementsByClassName('fgpv'));\n    var isAttrNodes = [].slice.call(document.querySelectorAll('[is=rv-map]'));\n    isAttrNodes.filter(function (node) {\n        return nodes.indexOf(node) === -1;\n    }).forEach(function (node) {\n        return nodes.push(node);\n    });\n\n    // store nodes to use in app-seed; avoids a second DOM traversal\n    RV._nodes = nodes;\n\n    var counter = 0;\n\n    nodes.forEach(function (node) {\n\n        var appId = node.getAttribute('id');\n        customAttrs.filter(function (attrName) {\n            return node.getAttribute('data-rv-' + attrName);\n        }).forEach(function (attrName) {\n            return node.setAttribute('rv-' + attrName, node.getAttribute('data-rv-' + attrName));\n        }); // getAttribute returns a string so data-rv-fullscreen-app=\"false\" will copy correctly\n\n        if (!appId) {\n            appId = 'rv-app-' + counter++;\n            node.setAttribute('id', appId);\n        }\n\n        node.setAttribute('rv-trap-focus', appId);\n\n        // basic touch device detection; if detected set rv-touch class so that touch mode is on by default\n        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n            node.className += ' rv-touch';\n        }\n\n        console.info('setting debug on', appId, node);\n        // create debug object for each app instance\n        RV.debug[appId] = {};\n\n        mapRegistry[appId] = Object.create(mapProxy)._init(appId);\n    });\n\n    scriptsArr.forEach(function (src) {\n        return loadScript(src);\n    });\n\n    // load core.js last and execute any deferred polyfills/patches\n    loadScript(repo + '/core.js', function () {\n        RV._deferredPolyfills.forEach(function (dp) {\n            return dp();\n        });\n        RV.focusManager.init();\n        RV.allScriptsLoaded = true;\n        fireRvReady();\n    });\n\n    /***/\n\n    /**\r\n     * Called to buffer code until the library code has been fully loaded.  Behaves similar to jQuery style DOM ready events.\r\n     * @function\r\n     * @param {Function} callBack a function to be called once the library is loaded\r\n     */\n    function ready(callBack) {\n        if (RV.allScriptsLoaded) {\n            callBack();\n        } else {\n            readyQueue.push(callBack);\n        }\n    }\n\n    /**\r\n     * Fires all callbacks waiting on the ready event and empties the callback queue.\r\n     * @private\r\n     */\n    function fireRvReady() {\n        readyQueue.forEach(function (cb) {\n            return cb();\n        });\n        readyQueue = [];\n    }\n\n    // external \"sync\" function to retrieve a map instance\n    // in reality it returns a map proxy queueing calls to the map until it's ready\n    function getMap(id) {\n        return mapRegistry[id];\n    }\n\n    /**\r\n     * Load a script and execute an optional callback\r\n     * @function\r\n     * @private\r\n     * @param {String} src url of the script to load\r\n     * @param {Function} loadCallback [optional] a callback to execute on script load\r\n     * @return {Object} script tag\r\n     */\n    function loadScript(src, loadCallback) {\n        var currScript = d.createElement('script');\n        currScript.src = src;\n        currScript.async = false;\n        currScript.type = 'text/javascript';\n\n        if (typeof loadCallback === 'function') {\n            currScript.addEventListener('load', loadCallback);\n        }\n\n        bodyNode.appendChild(currScript);\n\n        return currScript;\n    }\n\n    /**\r\n     * Compares two versions of a script, prints warnings to the console if the versions are not the same\r\n     *\r\n     * @private\r\n     * @function versionCheck\r\n     * @param  {String} ourVersion      our version of the script\r\n     * @param  {String} theirVersion    their version of the script\r\n     * @param  {String} scriptName      the name of the script\r\n     */\n    function versionCheck(ourVersion, theirVersion, scriptName) {\n        ourVersion = ourVersion.split('.');\n        var versionDiff = theirVersion.split('.')\n        // compare the two versions\n        .map(function (x, index) {\n            return parseInt(x) - ourVersion[index];\n        })\n        // find first non-equal part\n        .find(function (x) {\n            return x !== 0;\n        });\n\n        if (typeof versionDiff === 'undefined') {\n            // the versions were equal\n            return;\n        }\n        var fillText = versionDiff > 0 ? 'more recent' : 'older';\n        console.warn('The current ' + scriptName + ' version is ' + fillText + ' than expected for the viewer; ' + ('expected: ' + versions.jQuery));\n    }\n})();\n\n(function () {\n    'use strict';\n\n    var RV = window.RV; // just a reference\n    RV.debug._trackFocus = trackFocusBuilder();\n\n    /**\r\n     * Builds a focus tracking debug option.\r\n     * @function trackFocusBuilder\r\n     * @private\r\n     * @return function  enables/disabled focus/blur event tracking on the page; this function accepts a boolean - `true` enables tracking; `false`, disables it\r\n     */\n    function trackFocusBuilder() {\n        var lastActiveElement = document.activeElement;\n\n        var isActive = false;\n\n        return function () {\n            isActive = !isActive;\n            if (isActive) {\n                console.debug('trackFocus is enabled.');\n                attachEvents();\n            } else {\n                console.debug('trackFocus is disabled.');\n                detachEvents();\n            }\n        };\n\n        /***/\n\n        /**\r\n         * Logs blur events.\r\n         * @function detectBlur\r\n         * @private\r\n         * @param  {Object} event blur event\r\n         */\n        function detectBlur(event) {\n            // Do logic related to blur using document.activeElement;\n            // You can do change detection too using lastActiveElement as a history\n            console.debug('[trackFocus]: blur', document.activeElement, event, isSameActiveElement());\n        }\n\n        /**\r\n         * Checks if the currently active element is the same as the previosly focused one.\r\n         * @function isSameActiveElement\r\n         * @private\r\n         * @return {Boolean} true if it's the same object\r\n         */\n        function isSameActiveElement() {\n            var currentActiveElement = document.activeElement;\n            if (lastActiveElement !== currentActiveElement) {\n                lastActiveElement = currentActiveElement;\n                return false;\n            }\n\n            return true;\n        }\n\n        /**\r\n         * Logs focus events.\r\n         * @function detectFocus\r\n         * @private\r\n         * @param  {Object} event focus event\r\n         */\n        function detectFocus(event) {\n            // Add logic to detect focus and to see if it has changed or not from the lastActiveElement.\n            console.debug('[trackFocus]: focus', document.activeElement, event, isSameActiveElement());\n        }\n\n        /**\r\n         * Attaches listeners to the window to listen for focus and blue events.\r\n         * @function attachEvents\r\n         * @private\r\n         */\n        function attachEvents() {\n            window.addEventListener('focus', detectFocus, true);\n            window.addEventListener('blur', detectBlur, true);\n        }\n\n        /**\r\n         * Detaches focus and blur listeners from the window.\r\n         * @function detachEvents\r\n         * @private\r\n         */\n        function detachEvents() {\n            window.removeEventListener('focus', detectFocus, true);\n            window.removeEventListener('blur', detectBlur, true);\n        }\n    }\n})();"]}